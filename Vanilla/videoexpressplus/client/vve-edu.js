!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).VideoExpressPlus={})}(this,(function(n){"use strict";!function(n,t){void 0===t&&(t={});var e=t.insertAt;if(n&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===e&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}('.container {\n  display: flex;\n  flex-direction: row;\n}\n\n\n.call-control {\n    position: absolute;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 90px;\n    background-color: #000;\n    padding: 0 30px;\n  }\n  \n  \n  /* Assuming the name of the Room\'s container is roomContainer */\n  [id$="-roomcontainer"] {\n    width: calc(100vw - 480px);\n    /* width: 200px; */\n    height: calc(100vh - 150px);\n    background-color: #111;\n    /* position: absolute; */\n    top: 60px;\n    left: 0;\n    bottom: 90px;\n    display: none;\n  }\n  \n  .iframe-container {\n    display: none;\n    position: absolute;\n    height: calc(100vh - 150px);\n    top: 60px;\n    left: 200px;\n    right: 16px;\n    bottom: 90px;\n    background-color: white;\n    z-index:9999;\n  }\n  \n  #control {\n    /* display: none; */\n  }\n  \n  iframe {\n    width: 100%;\n    height: 100%;\n  }\n  \n  .room > .OT_publisher {\n    top: 25px;\n    right: 25px;\n    position: absolute;\n    border-radius: 10px;\n  }\n  .room > .OT_screenshare {\n    top: 25px;\n    left: 25px;\n    position: absolute;\n    border-radius: 10px;\n  }\n  \n  [id$="-control"] > div {\n    position: absolute;\n    top: 60px;\n    right: 0px;\n    width: 450px;\n    height: calc(100vh - 150px);\n    border: 1px solid black;\n    padding-left: 16px;\n    padding-right: 16px;\n    border-radius: 16px;\n    background-color: #fff;\n  }\n  \n  #addons {\n    display: block;\n  }\n  \n  #breakout {\n    display: none;\n  }\n  \n  #poll {\n    display: none;\n  }\n  \n  #question {\n    display: none;\n  }\n  \n  #addons .header {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n    padding: 16px;\n  }\n  \n  #addons .item {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    padding: 16px;\n    border-radius: 8px;\n    border: 1px solid #eee;\n    margin-bottom: 8px;\n  }\n  \n  #addons .icon {\n    padding: 8px;\n    background-color: rgb(245, 240, 253);\n    margin-right: 8px;\n    border-radius: 4px;\n  }\n  \n  #addons .item:hover {\n    background-color: #eee;\n    cursor: pointer;\n  }\n  \n  #addons .text {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    justify-content: center;\n    padding: 0 20px;\n  }\n  \n  #addons .title {\n    font-size: 16px;\n    font-weight: bold;\n    color: #000;\n    margin-bottom: 8px;\n  }\n  \n  #addons .sub-title {\n    font-size: 12px;\n    font-weight: 100;\n    color: #444;\n  }\n  \n  /* vve-mic-button::part(button){\n    color: white;\n  }\n  \n  vve-video-button::part(button){\n    color: white;\n  } */\n  \n  vve-activities,\n  vve-text-chat,\n  vve-participants {\n    padding: 0;\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    font-family: Roboto;\n    overflow-y: auto;\n  }\n  \n  vve-activities::part(title),\n  vve-text-chat::part(title),\n  vve-participants::part(title) {\n    font-size: 1.17em;\n    margin-block-start: 1em;\n    margin-block-end: 1em;\n    margin-inline-start: 0px;\n    margin-inline-end: 0px;\n    font-weight: bold;\n  }\n  \n  vve-activities::part(header),\n  vve-text-chat::part(header),\n  vve-participants::part(header) {\n    padding: 16px;\n  }\n  \n  vve-participants::part(subheader) {\n    padding: 16px 16px 0 16px;\n  }\n  \n  vve-activities::part(name) {\n    font-size: 16px;\n    font-weight: bold;\n    color: #000;\n  }\n  \n  vve-activities::part(activity) {\n    font-size: 12px;\n    font-weight: 100;\n    color: #444;\n  }\n  \n  #activities,\n  #lower-hand-button,\n  #screenshare-stop-button,\n  #chat,\n  #participants {\n    display: none;\n  }\n  \n  vve-activities::part(list) {\n    height: calc(100% - 100px);\n  }\n  \n  vve-text-chat::part(messages-container) {\n    height: calc(100% - 170px);\n  }\n  \n  vve-text-chat::part(messages-feed) {\n    height: 100%;\n  }\n  \n  vve-text-chat::part(time) {\n    color: rgba(0, 0, 0, 0.54);\n    font-size: 14px;\n  }\n  \n  vve-text-chat::part(message-text) {\n    color: black;\n    font-size: 20px;\n  }\n  \n  vve-closed-captions::part(username),\n  vve-closed-captions::part(time),\n  vve-closed-captions::part(message-text) {\n    color: white;\n  }\n  .hand-raise {\n    top: 12px;\n    left: 12px;\n    right: auto;\n    bottom: auto;\n    display: flex;\n    position: absolute;\n    color: white;\n    background-color: black;\n    padding: 5px !important;\n    border-radius: 5px !important;\n  }\n  \n  #lower-hand-button {\n    display: none;\n  }\n  \n  .invert-icon {\n    filter: invert(1);\n  }\n  \n  #main {\n    position: relative;\n  }\n  \n  #closed-captions-container {\n    display: none;\n    color: white;\n    position: absolute;\n    z-index: 20;\n    bottom: 0;\n    background-color: rgba(0, 0, 0, 0.75);\n    width: 100%;\n    height: 300px;\n  }\n  \n  #cc-on-button {\n    display: none;\n  }\n  \n  #waiting-banner {\n    background: #7a7a7a;\n    height: 100px;\n    padding: 20px;\n    font-size: 32px;\n    border-radius: 8px;\n    margin: 0px 493px 0px 10px;\n    text-align: center;\n    display: none;\n  }\n  ');const t=async(n,t)=>{try{return(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"getRoomData",roomId:n})})).json()}catch(n){console.log(n)}},e=n=>{const t=document.createElement("div");return t.setAttribute("id",n),t};n.RoomController=class{logLabel="VideoExpressPlusClient:RoomController";constructor(n,t,e,o){this.participantId=t,this.callbackUrl=e,this.managedLayoutOptions=o,this.containerElement=document.getElementById(n),this.prefix="vveplus",this.publisherProperties={height:"100%",width:"100%",audioSource:localStorage.getItem("audioSourceId"),videoSource:localStorage.getItem("videoSourceId")},localStorage.getItem("backgroundBlur")}async getWhiteBoardParticipantCredentials(){try{const n=await fetch("/api/whiteboard/sessions/join",{method:"POST"});return await n.json()}catch(n){console.log(n)}}async getWhiteBoardAdminCredentials(n){try{const t=await fetch("/api/whiteboard/sessions/create",{method:"POST",body:JSON.stringify({boardName:`${n}-board`})});return await t.json()}catch(n){console.log(n)}}async allowParticipant(n){console.log("Allow Participant Called",n);const t=this;try{const e=await fetch("/api/vve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"updateWaitingState",name:n,state:{state:!0}})}),o=await e.json();return t.participants=t.participants.filter((t=>t.name!==n)),o}catch(n){console.log(n)}}async showWhiteBoardToNonHosts(){}async dismissParticipant(n){console.log("Dismiss Participant Called",n)}goBack(){this.hideAll(),this.showAddons()}async updateParticipantId(n,t){try{return await fetch("/api/vve/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"updateParticipantId",name:t,participantId:n})})}catch(n){console.log(n)}}async joinBreakOutRoom(n,t){try{return await fetch("/api/vve/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"joinBreakOutRoom",name:t,breakoutRoomId:n})})}catch(n){console.log(n)}}async leaveRoom(){await this.room.leave(),window.location.href="/"}joinRoom(n,t,e){console.log("Join Room Called"),this.joinBreakOutRoom(t,e).then((n=>console.log(n)))}async createRoom(n="vveplus"){let t;try{const n=await fetch("/api/vve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"createBreakoutRoom"})});t=await n.json()}catch(n){return void console.log(n)}const e=window.crypto.getRandomValues(new Uint32Array(1))[0],o=document.getElementById("main"),i=document.createElement("div"),a=`${n}-roomcontainer-${e.toString(16)}`;i.setAttribute("id",a),o?.appendChild(i);return new VideoExpress.Room({sessionId:t?.break.sessionId,apiKey:t?.break.apiKey,token:t?.break.token,roomContainer:a})}async joinMainRoom(n){console.log("parent asked to join ",n);const t={main:n};this.room=new VideoExpress.Room({sessionId:t.main.sessionId,apiKey:t.main.apiKey,token:t.main.token,participantName:this.name,roomContainer:`${this.prefix}-roomcontainer`});const{camera:e,screen:o}=this.room;this.room.join({publisherProperties:this.publisherProperties}),this.room.on("connected",(()=>{console.log("room connected"),console.log("audio enabled: ",e.isAudioEnabled()),console.log("video enabled: ",e.isVideoEnabled()),this.breakout.room=this.room;const n=document.getElementById(this.room.roomContainer);null!=n&&(n.style.display="block")})),this.room.on("signal:remove",(async n=>{console.log("signal:remove: ",n),n.isSentByMe||await this.leaveRoom()})),this.room.on("signal:raise_hand",(n=>{console.log("signal:raise_hand: ",n);const t=this.handRaiseTemplate.content.firstElementChild.cloneNode(!0);let o,i;n.isSentByMe?(console.log("camera id: ",e),i="#MP_camera_publisher_default_controls-hand",o=document.querySelector("#MP_camera_publisher_default_controls")):(console.log("camera id: ",n.from.camera.id),i=`${n.from.camera.id}-hand`,o=document.querySelector(`#MP_${n.from.camera.id}_default_controls`)),console.log("selected feed: ",o),t.id=i,null!=o&&o.appendChild(t)})),this.room.on("signal:lower_hand",(n=>{let t;console.log("signal:lower_hand: ",n),n.isSentByMe?(console.log("camera id: ",e),t="#MP_camera_publisher_default_controls-hand"):(console.log("camera id: ",n.from.camera.id),t=`${n.from.camera.id}-hand`),void 0!==document.getElementById(t)&&document.getElementById(t)?.remove()})),this.room.on("signal:lower_hand_teacher",(n=>{let t;console.log("signal:lower_hand_teacher: ",n),n.isSentByMe||(console.log("camera id: ",n.from.camera.id),t="#MP_camera_publisher_default_controls-hand",void 0!==document.getElementById(t)&&document.getElementById(t)?.remove())}))}addWebComponent(n,t){const e=document.createElement("div");e.setAttribute("id",n);const o=document.createElement(`vve-${n}`);e.append(o),t.append(e)}addWaitingRoomBanner(){const n=e("waiting-banner");document.body.appendChild(n)}toggleWaitingRoomBanner(){const n=document.getElementById("waiting-banner");null!=n&&("block"===n.style.display?n.style.display="none":(n.style.display="block",n.textContent="Please wait while host allow you to the meeting"))}addWhiteBoardIframe(){this.containerElement.insertAdjacentHTML("beforebegin",'<div class="iframe-container"><vwc-button appearance="filled" connotation="accent" id="go-back-whiteboard" icon="arrow-left-line" aria-label="Go Back"></vwc-button><iframe id="whiteboard-iframe"></iframe></div>')}toggleWhiteboardIframe(){const n=this.whiteBoardContainer;void 0!==n&&("block"===n.style.display?n.style.display="none":n.style.display="block")}loadSkeleton(n="vveplus"){this.containerElement.insertAdjacentHTML("afterbegin",`<div id="main"><div id="${n}-roomcontainer" class="room"></div></div><div id="${n}-control"></div>`)}loadWebComponents(n="vveplus"){this.roomContainer=document.getElementById(`${n}-roomcontainer`),this.controlContainer=document.getElementById(`${n}-control`),this.controlContainer.insertAdjacentHTML("afterbegin",'<h3>Go Back</h3><vwc-icon-button id="close-addons" icon="close"></vwc-icon-button>'),this.addWebComponent("breakout",this.controlContainer),this.addWebComponent("waiting",this.controlContainer),this.addWaitingRoomBanner(),this.addWhiteBoardIframe(),this.addWebComponent("text-chat",this.controlContainer),this.breakout=document.querySelector("vve-breakout"),this.waiting=document.querySelector("vve-waiting"),this.handRaiseTemplate=document.querySelector("#hand-raise-template")}addMenuItem(n,t,e,o){const i=document.createElement("div");return i.setAttribute("id",`addon-${e}`),i.setAttribute("class","item"),i.insertAdjacentHTML("afterbegin",`<vwc-icon  type="${o}"></vwc-icon>\n    <div class="text">\n      <span class="title">${n}</span>\n      <span class="sub-title">${t}</span>\n    </div>`),i}loadAddonsMenu(){const n=e("addons"),t=(n=>{const t=document.createElement("div");return t.setAttribute("class",n),t})("header");t.insertAdjacentHTML("afterbegin",'<h3>Add ons</h3><vwc-icon-button id="close-addons" icon="close"></vwc-icon-button>'),n.appendChild(t);const o=this.addMenuItem("Create Breakout","Get a quick pulse of the audience","breakout","apps-line");n.appendChild(o);const i=this.addMenuItem("Waiting Room","See Who is waiting","waiting","group-permission-2-solid");n.appendChild(i);const a=this.addMenuItem("Whiteboard","Brainstorm and Sketch Ideas","whiteboard","video-whiteboard-line");n.appendChild(a),this.controlContainer?.appendChild(n)}hideAll(){this.breakoutContainer.style.display="none",this.waitingContainer.style.display="none",this.addonsContainer.style.display="none",this.chatContainer.style.display="none"}showBreakout(){this.breakoutContainer.style.display="block"}showWaiting(){this.waitingContainer.style.display="block"}showAddons(){this.addonsContainer.style.display="block"}hideWhiteBoard=()=>{this.roomContainer.style.width="calc(100vw - 480px)",this.whiteBoardContainer.style.display="none",this.addonsContainer.style.display="block"};async showWhiteBoard(){if("host"!==this.role){const n=await this.getWhiteBoardParticipantCredentials(),t=n.participantsTokens[0],e=`https://whiteboard.vonage.com/embed/${n.sessionId}?display_name=${this.name}&token=${t}`;this.whiteBoardIframe.src=e,this.hideAll(),this.roomContainer.style.width="200px",this.toggleWhiteboardIframe()}else{const n=await this.getWhiteBoardAdminCredentials(this.name);console.log(n);const t=`https://whiteboard.vonage.com/embed/${n.sessionId}?display_name=${this.name}&token=${n.ownerToken}`;this.whiteBoardIframe.src=t,this.hideAll(),this.roomContainer.style.width="200px",this.toggleWhiteboardIframe()}}openBreakoutRoom(){this.createRoom()}attachEvents(){this.addonsBreakoutButton=document.getElementById("addon-breakout"),this.addonsWaitingButton=document.getElementById("addon-waiting"),this.addonsWhiteBoardButton=document.getElementById("addon-whiteboard"),this.breakoutContainer=document.getElementById("breakout"),this.breakoutMsg=document.getElementById("breakout-msg"),this.breakoutButton=document.getElementById("breakout-button"),this.waitingContainer=document.getElementById("waiting"),this.addonsContainer=document.getElementById("addons"),this.whiteBoardContainer=document.querySelector(".iframe-container"),this.whiteBoardIframe=document.getElementById("whiteboard-iframe"),this.chatContainer=document.getElementById("text-chat"),this.addonsBreakoutButton.addEventListener("click",(()=>{"host"===this.role&&(this.hideAll(),this.showBreakout())})),this.addonsWaitingButton.addEventListener("click",(()=>{"host"===this.role&&(this.hideAll(),this.showWaiting())}));const n=document.getElementById("go-back-whiteboard");null!=n&&n.addEventListener("click",(()=>{this.hideAll(),this.hideWhiteBoard(),this.showAddons()})),this.addonsWhiteBoardButton.addEventListener("click",(()=>{this.hideAll(),this.showWhiteBoard()}))}async attachSessionEvents(){if(this.parentSession.on("signal:waiting-participant",(n=>{if(console.log("Waiting request recieved",n.data),"host"===this.role){const t=n.data;t.roomId="main",this.waiting.participants=this.waiting.participants||[],this.waiting.participants=[...this.waiting.participants,t]}})),this.parentSession.on("connectionDestroyed",(n=>{this.waiting.participants=this.waiting.participants.filter((t=>t.id!==n.connection.connectionId))})),this.parentSession.on("signal:allow-participant",(async n=>{console.log("Waiting request Approved",n.data),this.toggleWaitingRoomBanner(),"host"!==this.role&&this.joinMainRoom(n.data.main)})),this.parentSession.on("signal:command",(async n=>{const t=n.data;await this.room.leave();const e=document.getElementById(`${this.prefix}-roomcontainer`);null!=e&&(e.innerHTML=""),this.brkroom=new VideoExpress.Room({sessionId:t.break.sessionId,apiKey:t.break.apiKey,token:t.break.token,participantName:this.name,roomContainer:`${this.prefix}-roomcontainer`}),this.brkroom.join({publisherProperties:this.publisherProperties})})),this.parentSession.on("signal:close-all",(async n=>{console.log("Joining Main Room",n.data),await this.brkroom.leave();const e=document.getElementById(`${this.prefix}-roomcontainer`);null!=e&&(e.innerHTML="");const o=await t(n.data,this.callbackUrl);this.room=new VideoExpress.Room({sessionId:o.main.sessionId,apiKey:o.main.apiKey,token:o.main.token,participantName:this.name,roomContainer:`${this.prefix}-roomcontainer`}),this.room.join({publisherProperties:this.publisherProperties})})),this.parentSession.on("signal:text_chat",(n=>{console.log(`Parent Signal sent from connection ${n.from.id}`),console.log("payload",n.data)})),"host"===this.role){this.room=new VideoExpress.Room({sessionId:this.roomData.main.sessionId,apiKey:this.roomData.main.apiKey,token:this.roomData.main.token,participantName:this.name,roomContainer:`${this.prefix}-roomcontainer`});const{camera:n,screen:t}=this.room;this.room.join({publisherProperties:this.publisherProperties}),this.room.on("connected",(()=>{console.log("room connected"),console.log("audio enabled: ",n.isAudioEnabled()),console.log("video enabled: ",n.isVideoEnabled()),this.breakout.room=this.room;const t=document.getElementById(this.room.roomContainer);null!=t&&(t.style.display="block")})),this.room.on("signal:remove",(async n=>{console.log("signal:remove: ",n),n.isSentByMe||await this.leaveRoom()}))}else this.toggleWaitingRoomBanner()}async initSession(n){this.roomData=await t(n,this.callbackUrl),this.parentSession=OT.initSession(this.roomData.parent.apiKey,this.roomData.parent.sessionId),this.parentSession.on("sessionConnected",(async n=>{await this.updateParticipantId(n.target.connection.connectionId,this.name),"host"!==this.role&&(console.log("Waiting request Sent"),this.parentSession.signal({data:{id:n.target.connection.connectionId,name:this.name},type:"waiting-participant"}))})),this.parentSession.connect(this.roomData.parent.token,(n=>{n?console.log(n.message):(console.log("Parent Session Connected!"),this.breakout.parent=this.parentSession,this.waiting.parent=this.parentSession,this.breakout.role=this.role,this.breakout.createRoom=this.createRoom,this.breakout.joinRoom=this.joinRoom.bind(this),this.waiting.allowParticipant=this.allowParticipant,this.waiting.dismissParticipant=this.dismissParticipant,this.waiting.goBack=this.goBack.bind(this),this.attachSessionEvents())}))}async init(){console.group(this.logLabel),console.log("retrieving server config now..",this.callbackUrl);const n=window.location.pathname.split("/")[2],t=new URLSearchParams(window.location.search);this.name=t.get("name"),this.role=t.get("role"),this.loadSkeleton(this.prefix),this.loadWebComponents(this.prefix),"host"===this.role&&(this.loadAddonsMenu(),this.attachEvents()),this.initSession(n),console.log("%c Initialization Complete!","color: #bada55"),console.groupEnd()}onError(){}setProxyUrl(n){this.proxyUrl=n}},Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=vve-edu.js.map
